- name: Deploy to GitHub Pages
  env:
    GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
  run: |
    cd docs/.vitepress/dist
    echo 'www.hefang.site' > CNAME

    # 初始化 Git 仓库
    git init
    git config user.email "he529564582@163.com"
    git config user.name "何方"

    # 添加远程仓库和获取远程分支的最新状态
    git remote add origin "https://${GITHUB_ACTOR}:${GITHUB_TOKEN}@github.com/hefangs/coding.git"
    git fetch origin gh-pages

    # 创建一个新的分支，用于合并更改
    git checkout -b deploy-branch

    # 合并远程的 gh-pages 分支
    git merge origin/gh-pages

    # 添加变更并提交
    git add -A
    CURRENT_DATE=$(TZ='Asia/Shanghai' date +"%Y-%m-%d_%H:%M:%S")
    COMMIT_MESSAGE="deploy.yml-$CURRENT_DATE"
    git commit -m "$COMMIT_MESSAGE" || echo "No changes to commit"

    # 强制推送到 gh-pages 分支
    git push -f origin deploy-branch:gh-pages
